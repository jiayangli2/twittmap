<!DOCTYPE html>
<html>
    <head>
        <style>
            #map {
                height: 400px;
                width: 100%;
            }
        </style>
    </head>
    <body>
        <p>Select a keyword and see relative tweets on the map!</p>
        <form>
            <select name="keyword" id="keyword", onchange="myMap()">
                <option value="movie">movie</option>
                <option value="iPhone">iPhone</option>
                <option value="music">music</option>
                <option value="spring">spring</option>
                <option value="hot">hot</option>
                <option value="twitter">twitter</option>
                <option value="a">a</option>
            </select> 

        </form>

        <h3>My Google Maps Demo</h3>
        <div id="map"></div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

        <script>
            function myMap() {
                var myLatlng = new google.maps.LatLng(-25.363882, 131.044922);
                var mapOptions={
                    zoom: 4,
                    center: myLatlng
                }
                var map = new google.maps.Map(document.getElementById("map"), mapOptions);
                var i=0;

                var num_query="https://search-es-twitter-demo-snhzuc3whnp44zlt2nx7iaqeaq.us-west-2.es.amazonaws.com/tmsg/_search?q=*";
                var totalitem;
                $.ajax({
                    async: false,
                    url: num_query,
                    success: function(d1){
                        totalitem=d1.hits.total;
                    }
                });
                var abc = "https://search-es-twitter-demo-snhzuc3whnp44zlt2nx7iaqeaq.us-west-2.es.amazonaws.com/tmsg/_search?q=text:" + document.getElementById('keyword').value + "&pretty&size=" + totalitem;
                console.log(totalitem);
                $.getJSON(abc, function(d2){
                    ct = d2.hits.total;
                    for(var i=0; i<ct; i++){
                        var msg = d2.hits.hits[i]._source.text;
                        var y2=d2.hits.hits[i]._source.place.bounding_box.coordinates[0][0][0];
                        var y1=d2.hits.hits[i]._source.place.bounding_box.coordinates[0][0][1];
                        console.log(y1,y2);
                        var marker = new google.maps.Marker({
                            position: new google.maps.LatLng(y1, y2),
                            icon: getCircle(d2.hits.hits[i]._score),
                            map: map,
                            title: msg
                        });
                        marker.setMap(map);
                    }

                });
            }

            function getCircle(magnitude){
                return {
                    path: google.maps.SymbolPath.CIRCLE,
                    fillColor: 'yellow',
                    fillOpacity: .5,
                    scale: 6,
                    strokeColor: 'white',
                    strokeWeight: .5
                };
            }

        </script>
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAOd0yLa2PRCmldYBjXYLF5eZXhzaCv8jE&callback=myMap"></script>

    </body>
</html>

